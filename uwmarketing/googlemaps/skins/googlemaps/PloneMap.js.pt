<tal:block define="_dummy python:request.response.setHeader('content-type','text/javascript;;charset=utf-8')" />
<metal:block i18n:domain="uwmarketing.googlemaps">

var PloneMap = PloneMap || {} ;

PloneMap.prototype = new google.maps.MVCObject();

//PloneMap.prototype.SITE_URL = '<tal:block tal:replace="context/absolute_url"/>';

PloneMap.prototype.CURRENT_URL = '<tal:block tal:replace="context/absolute_url"/>';

PloneMap.prototype.polygons_   = [ ];

PloneMap.prototype.markers_    = [ ];

PloneMap.init = function ( ) {

    document.getElementById( 'googleMapPane' ).style.height = 475 + 'px';

    var map         = new PloneMap.Map( document.getElementById( 'googleMapPane' ) );

    var info_window = new PloneMap.UWInfoWindow();

    var markers     = (typeof PloneMapMarkers  != 'undefined' ) ? PloneMapMarkers  : {};

    var polygons    = (typeof PloneMapPolygons != 'undefined' ) ? PloneMapPolygons : {};

    var kml         = ( document.getElementById( 'kmlUrl' ) ) ? [ document.getElementById( 'kmlUrl' ) ] : [];

    for (var i = 0, l = markers.length; i < l; i++) {

        var marker = markers[ i ];

        new PloneMap.Marker( marker.type , marker.options );

    };

        
    for (var region in polygons ) {

        var options = {
                        paths  : polygons[ region ],
                      };

        new PloneMap.Polygon( region , options );
    
    };

    new PloneMap.Geocoder();

    for (var i = 0, l = kml.length; i < l; i++) {

        var kml = kml[ i ];

        new PloneMap.KML( kml.innerHTML );

    };
}

google.maps.event.addDomListener(window, 'load', PloneMap.init);

</metal:block>
